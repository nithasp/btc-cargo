<section id="products">
  <div class="inner">
    <div
      class="alert-success-box card p-3 bg-success d-flex flex-row justify-content-between align-items-center"
      *ngIf="isAlertMsgBoxDisplay"
    >
      <span class="text-white"
        >เพิ่มสินค้าเข้าตะกร้าเรียบร้อย (ดูสินค้าในตะกร้าได้ที่รูปรถเข็น)</span
      >
      <i
        class="ni ni-fat-remove text-white display-4 close-btn"
        (click)="closeAlertMsgBox()"
      ></i>
    </div>
    <h1 class="mb-4">Products</h1>
    <div class="loading" *ngIf="isLoading">
      <h1>Loading ...</h1>
    </div>

    <h1 *ngIf="!isShopExist" class="text-red">
      กรุณาเพิ่มร้านค้า ท่านสามารถติดต่อ Admin ได้เพื่อเพิ่มร้านค้า
    </h1>

    <h1 *ngIf="!isShopHasProduct" class="text-red">
      ตอนนี้ร้านของท่านยังไม่มีสินค้า ท่านสามารถติดต่อ Admin ได้เพื่อเพิ่มสินค้า
    </h1>

    <div class="products-container" *ngIf="!isLoading && cartData.length > 0">
      <p class="text-red mb-3">
        **สินค้าบางตัวต้องเลือกตัวเลือกก่อนจะกดสั่งซื้อ
      </p>
      <div class="row">
        <div class="item col-sm-6 col-md-4" *ngFor="let product of cartData">
          <div class="wrapper card bg-white p-3">
            <div class="wrap-img text-center">
              <img
                src="{{
                  product.uploads.length > 0
                    ? product.uploads[0].file
                    : 'assets/img/mockup-img/product-image-placeholder.jpg'
                }}"
                class="product-img"
                #productImgRef
              />
            </div>
            <p class="title mt-3">{{ product.name }}</p>
            <div class="variants">
              <div
                class="dropdown"
                dropdown
                [ngClass]="
                  product.variants.length === 0 ? 'cursor-disabled' : ''
                "
              >
                <button
                  class="btn btn-secondary dropdown-toggle variants-btn"
                  type="button"
                  id="dropdownMenuButton"
                  dropdownToggle
                  #variantsRef
                  [ngClass]="
                    product.variants.length === 0 ? 'hide-variants' : ''
                  "
                >
                  <span>{{
                    product.variants.length > 0 ? "ตัวเลือก" : "ไม่มีตัวเลือก"
                  }}</span>
                </button>
                <div
                  aria-labelledby="dropdownMenuButton"
                  *dropdownMenu
                  class="dropdown-menu"
                >
                  <a
                    class="dropdown-item"
                    *ngFor="let variant of product.variants"
                    (click)="
                      handleVariants(
                        product,
                        variant,
                        variantsRef,
                        priceRef,
                        productImgRef
                      )
                    "
                    >{{ variant.display_name }}</a
                  >
                </div>
              </div>
            </div>

            <div class="wrapper mt-2 d-flex justify-content-between">
              <span class="shop-number bold">{{ product.shop_name }}</span>
              <span class="price" #priceRef>
                ¥
                {{
                  product.variants.length > 0 && !product.is_simple
                    ? product.variants[0].price
                    : product.price
                }}
              </span>
            </div>
            <button
              class="btn btn-block btn-primary mt-3 add-to-cart"
              (click)="addItem(product, variantsRef.innerText)"
              [disabled]="variantsRef.innerText === 'ตัวเลือก'"
            >
              Add to cart
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <a class="cart-icon text-dark" [routerLink]="['/web/cart']">
    <i class="fas fa-cart-plus"></i>
    <div class="cart-item-number flex-center bg-danger">
      <span class="text-white">{{ totalQuantity || 0 }}</span>
    </div>
  </a>
  <app-overlay-loading></app-overlay-loading>
</section>
